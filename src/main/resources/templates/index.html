<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>form test</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <link rel="stylesheet" type="text/css" href="css/index.css" media="all" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  </head>
  <body>
	<form name="testForm" id="testForm" action="http://localhost:8080/api/member/test" method="post">
    <!-- <form name="testForm" id="testForm" action="http://15.165.158.164:8080/api/member/test" method="post"> -->
      <input type="hidden" name="updUser" value="inputUser">
      <fieldset>
        <legend>기본정보</legend>
        <label for="memName">
          <span>이름</span>
          <input type="text" name="memName" id="memName" required />
        </label>
        <label for="memId">
          <span>아이디</span>
          <input type="email" name="memId" id="memId" placeholder="mymail@mymail.com" required />
          <label for="mailYn">
            <span>email수신동의</span>
            <input type="checkbox" name="mailYn" id="mailYn" value="N"/>
          </label>
        </label>
        <label for="memPwd">
          <span>비밀번호</span>
          <input type="password" name="memPwd" id="memPwd" required />
        </label>
        <label for="memPwdChk">
          <span>비밀번호 확인</span>
          <input type="password" name="memPwdChk" id="memPwdChk" required />
        </label>
      </fieldset>
      <fieldset>
        <legend>추가정보</legend>
        <label for="memTel">
          <span>연락처</span>
          <input type="text" name="memTel" id="memTel" />
          <label for="snsYn">
            <span>SMS 수신동의</span>
            <input type="checkbox" name="snsYn" id="snsYn" value="N"/>
          </label>
        </label>
        <label for="memGender">
          <span>성별</span>
          <select name="memGender" required>
            <option>성별</option>
            <option value="MALE">남</option>
            <option value="FEMALE">여</option>
          </select>
        </label>
        <label for="memBirth">
          <span>생년월일</span>
          <input type="text" name="memBirth" id="memBirth" placeholder="ex)19930710"/>
        </label>
        <label for="memNick">
          <span>닉네임</span>
          <input type="text" name="memNick" id="memNick" required/>
        </label>
      </fieldset>
      <a href="#" class="submit">전송</a>
      <a href="#" class="get">조회</a>
    </form>
    <div id="viewData">
      <table>
        <thead>
          <tr>
            <th>이름</th>
            <th>아이디</th>
            <th>연락처</th>
            <th>성별</th>
            <th>생년월일</th>
            <th>가입일</th>
            <th>닉네임</th>
          </tr>
        </thead>

      </table>
    </div>

    <!-- <script src="js/jquery.ajax-cross-origin.min.js"></script> -->
    <script>
      $('document').ready(function(){

        // $.fn.serializeObject = function() {
        //
        //   var result = {}
        //   var extend = function(i, element) {
        //     var node = result[element.name]
        //     if ("undefined" !== typeof node && node !== null) {
        //       if ($.isArray(node)) {
        //         node.push(element.value)
        //       } else {
        //         result[element.name] = [node, element.value]
        //       }
        //     } else {
        //       result[element.name] = element.value
        //     }
        //   }
        //
        //   $.each(this.serializeArray(), extend)
        //   return result
        // }

        $('input:required, select:required').prev('span').prepend('<i>*</i>');



        // var formQueryString = $('#testForm').serialize();
        // var formJson = $('#testForm').serializeObject();
        // var formArray = $('#testForm').serializeArray();
        // console.log(formArray);
        // console.log(JSON.stringify(formArray));

        var dataArray = [];
        var dataObj = {};

        // function makeJson(){
        //   $('#testForm input').each(function(i,item){
        //     var inputName = $(item).attr('name');
        //     var inputValue = $(item).val();
        //     dataObj[inputName] = inputValue;
        //     dataArray.push(dataObj);
        //   });
        // }
        // makeJson();
        // var jsonData = JSON.stringify(dataArray);
        // console.log(jsonData);


        $('.submit').click(function(e){
          e.preventDefault();
          var formArray = $('#testForm').serializeArray();
          console.log(formArray);
          var object = {};
          for (var i = 0; i < formArray.length; i++){
              object[formArray[i]['name']] = formArray[i]['value'];
          }
          console.log(object);
          var checkLength = $('#testForm input[type=checkbox]').length;
          for(var i=0; i<checkLength; i++){
            var checkName = $('#testForm input[type=checkbox]').eq(i).attr('name');
            var checkValue = $('#testForm input[type=checkbox]').eq(i).val();
            object[checkName] = checkValue;
          }
          console.log(object);
          console.log(JSON.stringify(object));

          var headers = {};
          headers["Access-Control-Allow-Origin"] = "*";
          headers["Content-Type"] = "application/json";
          headers["X-Custom-Header"] = "pingpong";

          $.ajax({
            // crossOrigin: true,
            type:"POST",
            url:"http://localhost:8080/api/member/test",
            data:JSON.stringify(object),
            dataType:"json",
            //contentType : "application/json",
            headers:headers,
            success:function(json){
      				alert(json);
              console.log(JSON.stringify(formArray));
      			},
      			error:function(){
      				alert('error');
              console.log(JSON.stringify(formArray));
      			},
          });
        });


        $('.get').click(function(e){
          e.preventDefault();
          var headers = {};
          headers["Access-Control-Allow-Origin"] = "*";
          headers["Content-Type"] = "application/json";
          headers["X-Custom-Header"] = "pingpong";
          $.ajax({
            // crossOrigin: true,
            type:"GET",
            url:"http://localhost:8080/api/member/test",
            dataType:"json",
            headers:headers,
            success:function(json){

              console.log(json)
            },
            error:function(){
              alert('error');
            },
          });
        });


      });
    </script>
  </body>
</html>
